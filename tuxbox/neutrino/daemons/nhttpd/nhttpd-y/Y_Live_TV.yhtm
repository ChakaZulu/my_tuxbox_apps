<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link rel="stylesheet" type="text/css" href="/Y_Main.css">
<script language="JavaScript" type="text/javascript">
function do_stop()
{
	document.vlc.stop()
}
function doPlayOrPause()
{
	if( document.vlc.{=if-equal:{=browser=}~ie~playing~isplaying()=} )
	{
		document.v.PlayOrPause.value = " Play ";
		document.vlc.pause()
	} else 
	{
		document.v.PlayOrPause.value = "Pause";
		document.vlc.play()
	}
}
/*0=normal, 1=record, 2=transcode*/
function setControls(state)
{
	switch(state)
	{
		case 1:
			parent.panel.enablePanel(0);
			document.v.PlayOrPause.disabled=true;
			document.v.audiopid.disabled=true;
			document.v.stop.disabled=true;
			{=if-equal:{=browser=}~ie~
			document.v.record.value="Stop Rec";
			document.v.transcode.disabled=true;
			~=}
			document.v.audio_track.disabled=true;
			document.v.snapshot.disabled=true;
			break;
	
		case 2:
			parent.panel.enablePanel(0);
			document.v.PlayOrPause.disabled=true;
			document.v.audiopid.disabled=true;
			document.v.stop.disabled=true;
			{=if-equal:{=browser=}~ie~
			document.v.transcode.value = "Stop Trans";
			document.v.record.disabled=true;
			~=}
			document.v.audio_track.disabled=true;
			document.v.snapshot.disabled=true;
			break;
	
		default:
			parent.panel.enablePanel(1);
			document.v.PlayOrPause.disabled=false;
			document.v.audiopid.disabled=false;
			document.v.stop.disabled=false;
			{=if-equal:{=browser=}~ie~
			document.v.record.value="Record";
			document.v.transcode.value = "Transcode";
			document.v.record.disabled=false;
			document.v.transcode.disabled=false;
			~=}
			document.v.audio_track.disabled=false;
			document.v.snapshot.disabled=false;
	}
}
function doStop()
{
	document.v.PlayOrPause.value = " Play ";
	document.vlc.stop()
}
function doLockUnlock()
{
	if( document.v.lock.value == "Lock" )
	{
		document.v.lock.value = "Unlock";
		parent.dbox.location.href='/control/exec?Y_Live&live_lock'
	} else 
	{
		document.v.lock.value = "Lock";
		parent.dbox.location.href='/control/exec?Y_Live&live_unlock'
	}
}
function view_streaminfo()
{
	window.open("/fb/info.dbox2","streaminfo","width=400,height=400");
}
function doPlay()
{
	doStop();
	setControls(0);
	{=if-equal:{=browser=}~ie~
	var options = new Array(":http-caching=2000",":input-repeat=1");
	document.vlc.addTarget(document.v.url.value, options, 4+8, -666);
	document.vlc.next();
	=}
	document.vlc.play();
}

function doRecord()
{
	if(document.v.record.value == "Record")
	{
		var sel = document.v.mux.selectedIndex;
		var ymux = (sel != -1) ? document.v.mux[sel].value : "ts";
		var options = new Array(":sout=#duplicate{dst=display,dst=std{access=file,mux="+ymux+",url="+document.v.record_filename.value+"}}",":input-repeat=1");
		setControls(1);
		document.vlc.addTarget(document.v.url.value, options, 4+8, -666);
		document.vlc.next();
		document.vlc.play();
	}
	else
		doPlay();
}
function doTranscode()
{
	if(document.v.transcode.value == "Transcode")
	{
		var transcode = "#transcode{"+
			"width="	+document.v.twidth.value+
			",height="	+document.v.theight.value+
			",vcodec="	+document.v.vcodec.value+
			",vb="		+document.v.vb.value+
			",acodec="	+document.v.acodec.value+
			",ab="		+document.v.ab.value+
			",deinterlace}:";
		var stream = "dst=std{"+
			"access="+document.v.access.value+
			",mux="+document.v.tmux.value+
			",url="+document.v.tip.value+
			"}";
		
		if(document.v.tdisplay.checked)
			stream = stream+",dst=display";
		var options = new Array(":sout="+transcode+"duplicate{"+stream+"}", ":input-repeat=1");
	
		setControls(2);
		document.vlc.addTarget(document.v.url.value, options, 4+8, -666);
		document.vlc.next();
		document.vlc.play();
	}
	else
		doPlay();
}
function doChangeAudioPid()
{
	doToggleExpertMode(1);
	document.v.submit()
}
function doToggleExpertMode(docollapse)
{
	if(document.v.expert.value == "E+" && docollapse==0)
	{
		top.resizeBy(0,160);
		document.v.expert.value = "E-";
		document.all.ex.style.visibility="visible";
	} 
	else 	
		if(document.v.expert.value == "E-")
		{
			top.resizeBy(0,-160);
			document.v.expert.value = "E+";
			document.all.ex.style.visibility="hidden";
		}
}
function vlcPressKey(key)
{
	{=if-equal:{=browser=}~ie~
		keyvalue = document.vlc.getVariable(key);
		document.vlc.setVariable("key-pressed", keyvalue);
	~
		keyvalue = document.vlc.get_int_variable(key);
		document.vlc.set_int_variable("key-pressed", keyvalue);
	=}
}
function doSnapshot()
{
	vlcPressKey("key-snapshot");
}
function doChangeAudioChannel()
{
	vlcPressKey("key-audio-track");
}
function doRecord2()
{
	vlcPressKey("key-record");
}
</script>
<style>
td
{
	color: #436976; 
	font-family:Arial,Sans-Serif;
	font-size:8pt;
}

tr
{
	color: #436976; 
	font-family:Arial,Sans-Serif;
	font-size:8pt;
}
</style>
</head>
{=script:Y_Live prepare_tv=}

<body style="background-color: #f0faff">
<table class="y_live_table" cellspacing="0" bgcolor="#F0FAFF">
<tr><td>
{=if-equal:{=browser=}~ie~
	<OBJECT classid="clsid:E23FE9C6-778E-49D4-B537-38FCDE4887D8" 
	        width="384" height="288" id="vlc" events="True">
			<param name="Src" value="http://{=func:get_request_data host=}:31339/0,{=func:get_video_pids {=audiopid=}=}" />
			<param name="ShowDisplay" value="True" />
			<param name="Loop" value="False" />
			<param name="AutoPlay" value="False" />
		The VideoLan Client ActiveX is not installed.<br>
		You need <a href="http://www.videolan.org" target="_blank">VideoLan Client</a> V0.8.2 or higher.<br>
		Install with Option "ActiveX".
	</OBJECT>
</td></tr>
<tr><td>
	<form name="v" action="/Y_Live_Wait.yhtm" method="get">
		<div>
			<button class="y_live_button" type="button" value="E+" title="expert mode" name="expert" onClick="doToggleExpertMode(0)">E+</button>
			<button class="y_live_button" type="button" value="Pause" title="play or pause streaming" id="PlayOrPause" onClick="doPlayOrPause()">Pause</button>
			<button class="y_live_button" type="button" value="stop" title="stop streaming" name="stop" onClick="doStop()">Stop</button>
			<button class="y_live_button" type="button" value="mute" title="mute / unmute volume" onClick="document.vlc.toggleMute()">Mute</button>
			<button class="y_live_button" type="button" value="minus" title="lower volume" onClick="document.vlc.volume=document.vlc.volume-10;">-</button>
			<button class="y_live_button" type="button" value="plus" title="higher volume" onClick="document.vlc.volume = document.vlc.volume+10;">+</button>
			<button class="y_live_button" type="button" value="fullscreen" title="switch to fullscreen-mode - or use double-click" onClick="document.vlc.fullscreen()">F</button>
			<button class="y_live_button" type="button" value="Lock" title="lock / unlock TV (record mode, rc, lcd)" name="lock" onClick="doLockUnlock()">Lock</button>
			<button class="y_live_button" type="button" value="Streaminfo" title="view streaminfo" name="streaminfo" onClick="view_streaminfo()">S</button>
			<select size="1" class="y_live_audio_pids" name="audiopid" onChange="doChangeAudioPid()">
			{=func:get_audio_pids_as_dropdown=}
			</select>
			<br>
			<input type="hidden" name="browser" value="{=browser=}">
			<input type="hidden" name="url" value="http://{=func:get_request_data host=}:31339/0,{=func:get_video_pids {=audiopid=}=}">
		</div>
		<div name="ex" id="ex" style="visibility : hidden;">
			<table class="y_live_table" cellspacing="0" width="100%">
			<tr><td style="border-top: 1px solid #6D96A9;">Expert Mode</td>
			<td style="border-top: 1px solid #6D96A9;">
				<button class="y_live_button" type="button" title="create snapshot picture" name="snapshot" onClick="doSnapshot()">Snap</button>
				<button class="y_live_button" type="button" title="change VLC audio channel" name="audio_track" onClick="doChangeAudioChannel()">Audiochannel</button>
			</td>
			</tr>
			<tr ><td style="border-top: 1px solid #6D96A9;">Record</td>
			<td style="border-top: 1px solid #6D96A9;">
				<input type="text" name="record_filename" value="{=ini-get:/var/tuxbox/config/Y-Web.conf;vlc_record_path=}">&nbsp;
				Mux: <SELECT name="mux" class="y_live_button">
					<option value="ts" selected>ts</option>          
					<option value="ps">ps</option>          
				</SELECT>
				&nbsp;<button class="y_live_button" type="button" value="r" title="record stream to file" name="record" onClick="doRecord()">Record</button> 
			</td>
			</tr>
			<tr><td style="border-top: 1px solid #6D96A9;">Transcode</td>
			<td style="border-top: 1px solid #6D96A9;">
				Breite: <input type="text" name="twidth" size="4" value="384" class="y_live_button">
				Höhe: <input type="text" name="theight" size="4" value="288" class="y_live_button">
				&nbsp;<button class="y_live_button" type="button" value="transcode" title="transcode stream" name="transcode" onClick="doTranscode()">Transcode</button> 
			</td>
			</tr>
			<tr><td>&nbsp;&nbsp;<em>Video</em></td>
			<td>
				Codec: <SELECT name="vcodec" class="y_live_button">
					<option value="mp4v" selected>mp4v</option>          
					<option value="mp2v">mp2v</option>          
					<option value="DIV3">DIV3</option>          
					<option value="h264">h264</option>          
				</SELECT>
				Bitrate: <SELECT name="vb" class="y_live_button">
					<option value="1024">1024</option>          
					<option value="786">786</option>          
					<option value="512">512</option>          
					<option value="384" selected>384</option>          
					<option value="256">256</option>          
					<option value="128">128</option>          
					<option value="96">96</option>          
					<option value="64">64</option>          
				</SELECT>
				<input type="checkbox" name="tdisplay" value="1" title="Display on while transcoding" checked>Display on

			</td>
			</tr>
			<tr><td>&nbsp;&nbsp;<em>Audio</em></td>
			<td>
				Codec: <SELECT name="acodec" class="y_live_button">
					<option value="mp4a" selected>mp4a</option>          
					<option value="mp3">mp3</option>          
					<option value="mp2a">mp2a</option>          
					<option value="a52">a52</option>          
				</SELECT>
				Bitrate: <SELECT name="ab" class="y_live_button">
					<option value="192">192</option>          
					<option value="128">128</option>          
					<option value="96">96</option>          
					<option value="64">64</option>          
					<option value="32" selected>32</option>          
					<option value="16">16</option>          
				</SELECT>
			</td>
			</tr>
			<tr><td>&nbsp;&nbsp;<em>Access</em></td>
			<td>
				Type: <SELECT name="access" class="y_live_button">
					<option value="udp" selected>udp</option>          
					<option value="http">http</option>          
					<option value="RTP">RTP</option>          
				</SELECT>
				Mux: <SELECT name="tmux" class="y_live_button">
					<option value="ts" selected>ts</option>          
					<option value="ps">ps</option>          
					<option value="mp4">mp4</option>          
					<option value="mov">mov</option>          
				</SELECT>
				IP:Post : <input type="text" name="tip" size="12" value="localhost:1234" class="y_live_button">
			</td>
			</tr>
			</table>
		</div>
	</form>
~
	<embed type="application/x-vlc-plugin"
		name="vlc"  id="vlc"
		autoplay="yes" loop="yes" width="384" height="288"
		target="http://{=func:get_request_data host=}:31339/0,{=func:get_video_pids {=audiopid=}=}" >
	</embed>
</td></tr>
<tr><td>
	<form name="v" action="/Y_Live_Wait.yhtm" method="get">
		<input class="y_live_button" type="button" value="E+" title="expert mode" name="expert" onClick="doToggleExpertMode(0)">
		<input class="y_live_button" type="button" value="Pause" title="play or pause streaming" name="PlayOrPause" onClick="doPlayOrPause()">
		<button class="y_live_button" type="button" value="stop" title="stop streaming" name="stop" onClick="doStop()">Stop</button>
		<button class="y_live_button" type="button" value="mute" title="mute / unmute volume" onClick="document.vlc.mute()">Mute</button>
		<button class="y_live_button" type="button" value="minus" title="lower volume" onClick="document.vlc.set_volume(document.vlc.get_volume()-10);">-</button>
		<button class="y_live_button" type="button" value="plus" title="higher volume" onClick="document.vlc.set_volume(document.vlc.get_volume()+10);">+</button>
		<button class="y_live_button" type="button" value="fullscreen" title="switch to fullscreen-mode - or use double-click" onClick="document.vlc.fullscreen()">F</button>
		<input class="y_live_button" type="button" value="Lock" title="lock / unlock TV (record mode, rc, lcd)" name="lock" onClick="doLockUnlock()">
		<button class="y_live_button" type="button" value="Streaminfo" title="view streaminfo" name="streaminfo" onClick="view_streaminfo()">sinfo</button>
		<select size="1" class="y_live_audio_pids" name="audiopid" onChange="doChangeAudioPid()">
		{=func:get_audio_pids_as_dropdown=}
		</select>
		<br>
		<input type="hidden" name="browser" value="{=browser=}">
		<input type="hidden" name="url" value="http://{=func:get_request_data host=}:31339/0,{=func:get_video_pids {=audiopid=}=}">
		<div name="ex" id="ex" style="visibility : hidden;">
			<hr>
			<b>Expert Mode - (Mozilla - Experimental)</b><br>
			<button class="y_live_button" type="button" title="create snapshot picture" name="snapshot" onClick="doSnapshot()">Snapshot</button>
			<button class="y_live_button" type="button" title="change VLC audio channel" name="audio_track" onClick="doChangeAudioChannel()">change Audio Channel</button>
		</div>
	</form>
=}
</td></tr>
</table>
<script language="JavaScript" type="text/javascript">
	var res_w=parseInt("{=ini-get:/var/tuxbox/config/Y-Web.conf;live_resolution_w;384=}",10);
	var res_h=parseInt("{=ini-get:/var/tuxbox/config/Y-Web.conf;live_resolution_h;288=}",10);
	if(isNaN(res_w)) res_w=384;
	if(isNaN(res_h)) res_h=288;
	
	document.vlc.width=res_w;
	document.vlc.height=res_h;
	for (i = 0; i < document.v.audiopid.length; i++)
		if (document.v.audiopid.options[i].value == "{=if-empty:{=audiopid=}~00000~{=audiopid=}=}")
			document.v.audiopid.options[i].selected = true;
	doPlay();
</script>

</body>
</html>